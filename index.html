<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#06b6d4">
  <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png">
  <link rel="manifest" href="manifest.webmanifest">
  <title>Funzione Diastolica Nuragica</title>
  <link rel="stylesheet" href="style.css">
  <style>
    details.refs{ margin-top:8px; }
    details.refs > summary{ cursor:pointer; user-select:none; font-weight:600; }
    details.refs ul{ margin:8px 0 0 18px; }
    details.refs li{ margin:2px 0; }
    details.refs .warn{ color:#b45309; }
  </style>
</head>
<body>
<header class="appbar">
  <div class="brand">
    <img src="assets/icons/icon-192.png" alt="" class="logo">
    <div>
      <h1>Funzione Diastolica Nuragica</h1>
      <div class="subtitle">Calcolo pratico su smartphone</div>
    </div>
  </div>
</header>

<main>
  <div class="tabs" id="rootTabs" role="tablist">
    <div class="tab active" role="tab" aria-selected="true" tabindex="0" data-target="#sinus">Ritmo sinusale</div>
    <div class="tab" role="tab" aria-selected="false" tabindex="0" data-target="#af">Fibrillazione atriale</div>
    <div class="tab" role="tab" aria-selected="false" tabindex="0" data-target="#special">Popolazioni speciali</div>
    <div class="tab" role="tab" aria-selected="false" tabindex="0" data-target="#about">Info</div>
  </div>

  <div id="pages">
    <section id="sinus" class="section active" data-route="true">
      <h2>Ritmo sinusale</h2>
      <div class="grid">
        <div><label for="sin_eprime_sep">e′ settale (cm/s)</label><input id="sin_eprime_sep" type="number" inputmode="decimal"></div>
        <div><label for="sin_eprime_lat">e′ laterale (cm/s)</label><input id="sin_eprime_lat" type="number" inputmode="decimal"></div>
        <div><label for="sin_E">E (cm/s)</label><input id="sin_E" type="number" inputmode="decimal"></div>
        <div><label for="sin_ea">E/A</label><input id="sin_ea" type="number" inputmode="decimal"></div>
        <div><label for="sin_tr">TR max (m/s)</label><input id="sin_tr" type="number" inputmode="decimal"></div>
        <div><label for="sin_lavi">LAVi (mL/m²)</label><input id="sin_lavi" type="number" inputmode="decimal"></div>
      </div>
      <div class="hint">Criteri: e′ ridotta, E/e′ &gt;14, TR ≥2.8, LAVi &gt;34. Grading tramite E/A + indici.</div>
      <button id="calcSinus" class="btn">Calcola</button>
      <button class="btn ghost reset">↺ Reset</button>
      <div id="sinusResult" class="status" role="status" aria-live="polite" style="display:none"></div>
      <div id="sinusDetails" class="card" style="display:none"></div>
    </section>

    <section id="af" class="section" data-route="true">
      <h2>Fibrillazione atriale</h2>
      <div class="grid">
        <div><label for="af_E">E (cm/s) media 5–10 battiti</label><input id="af_E" type="number" inputmode="decimal"></div>
        <div><label for="af_ee_sep">E/e′ settale</label><input id="af_ee_sep" type="number" inputmode="decimal"></div>
        <div><label for="af_tr">TR max (m/s)</label><input id="af_tr" type="number" inputmode="decimal"></div>
        <div><label for="af_dt">DT (ms)</label><input id="af_dt" type="number" inputmode="numeric"></div>
        <div><label for="af_lavi">LAVi (mL/m²)</label><input id="af_lavi" type="number" inputmode="decimal"></div>
      </div>
      <div class="hint">Criteri: E/e′ &gt;11, TR ≥2.8, LAVi &gt;34, DT &lt;160.</div>
      <button id="calcAF" class="btn">Calcola</button>
      <button class="btn ghost reset">↺ Reset</button>
      <div id="afResult" class="status" role="status" aria-live="polite" style="display:none"></div>
      <div id="afDetails" class="card" style="display:none"></div>
    </section>

    <section id="special" class="section" data-route="true">
      <h2>Popolazioni speciali — Calcolatori</h2>
      <div class="tabs" id="spTabs">
        <div class="tab active" data-target="#sp_valv">Valvulopatie</div>
        <div class="tab" data-target="#sp_htx">Trapianto</div>
        <div class="tab" data-target="#sp_ph">Ipertensione polmonare</div>
        <div class="tab" data-target="#sp_block">Blocco/LBBB/Pacing</div>
        <div class="tab" data-target="#sp_restr">Restrittiva/Amiloidosi</div>
        <div class="tab" data-target="#sp_costr">Pericardite costrittiva</div>
        <div class="tab" data-target="#sp_hcm">HCM</div>
      </div>

      <div id="sp_valv" class="sub section active">
        <h3>Valvulopatie</h3>
        <div class="grid">
          <div><label for="valv_type">Tipo</label>
            <select id="valv_type">
              <option value="AS">AS</option><option value="AR">AR</option>
              <option value="MR">MR</option><option value="MS">MS</option>
              <option value="MAC">MAC</option>
            </select></div>
          <div><label for="valv_ee">E/e′ medio</label><input id="valv_ee" type="number"></div>
          <div><label for="valv_tr">TR max (m/s)</label><input id="valv_tr" type="number"></div>
          <div><label for="valv_pasp">PASP (mmHg)</label><input id="valv_pasp" type="number"></div>
          <div><label for="valv_pv_sd">PV S/D</label><input id="valv_pv_sd" type="number"></div>
          <div><label for="valv_lavi">LAVi (mL/m²)</label><input id="valv_lavi" type="number"></div>
          <div><label for="valv_ar_a">Ar–A (ms)</label><input id="valv_ar_a" type="number"></div>
        </div>
        <details class="refs"><summary>Riferimenti &amp; cut-off</summary>
          <ul>
            <li><strong>E/e′ ≥14</strong>, <strong>TR ≥2.8</strong> o <strong>PASP ≥35</strong></li>
            <li><strong>PV S/D ≤0.67</strong>, <strong>LAVi &gt;34</strong>, <strong>Ar–A &gt;30</strong></li>
            <li class="warn">MR severa / MS / MAC moderata‑severa → usare criteri dedicati</li>
          </ul>
        </details>
        <button id="calcValv" class="btn">Calcola</button><button class="btn ghost reset">↺ Reset</button>
        <div id="valvResult" class="status" role="status" aria-live="polite" style="display:none"></div>
        <div id="valvDetails" class="card" style="display:none"></div>
      </div>

      <div id="sp_htx" class="sub section">
        <h3>Trapianto cardiaco</h3>
        <div class="grid">
          <div><label for="htx_eprime">e′ medio (cm/s)</label><input id="htx_eprime" type="number"></div>
          <div><label for="htx_ee">E/e′</label><input id="htx_ee" type="number"></div>
          <div><label for="htx_tr">TR max (m/s)</label><input id="htx_tr" type="number"></div>
          <div><label for="htx_pv_sd">PV S/D</label><input id="htx_pv_sd" type="number"></div>
          <div><label for="htx_lavi">LAVi (mL/m²)</label><input id="htx_lavi" type="number"></div>
        </div>
        <details class="refs"><summary>Riferimenti &amp; cut-off</summary>
          <ul>
            <li><strong>E/e′ &lt;7</strong> → normale; <strong>&gt;14</strong> → elevata; 7–14 → usa TR o indici di supporto</li>
            <li>TR ≤2.8 → normale; TR &gt;2.8 → LAP ↑; Supporto: PV S/D ≤0.67, LAVi &gt;34, e′ ≤6.5</li>
          </ul>
        </details>
        <button id="calcHtx" class="btn">Calcola</button><button class="btn ghost reset">↺ Reset</button>
        <div id="htxResult" class="status" role="status" aria-live="polite" style="display:none"></div>
        <div id="htxDetails" class="card" style="display:none"></div>
      </div>

      <div id="sp_ph" class="sub section">
        <h3>Ipertensione polmonare</h3>
        <div class="grid">
          <div><label for="ph_ea">E/A</label><input id="ph_ea" type="number"></div>
          <div><label for="ph_ee_lat">E/e′ laterale</label><input id="ph_ee_lat" type="number"></div>
          <div><label for="ph_lavi">LAVi (mL/m²)</label><input id="ph_lavi" type="number"></div>
          <div><label for="ph_lars">LARS (%)</label><input id="ph_lars" type="number"></div>
        </div>
        <details class="refs"><summary>Riferimenti &amp; cut-off</summary>
          <ul>
            <li><strong>E/A ≤0.8</strong> → pre‑capillare; <strong>E/A ≥2</strong> → post‑capillare</li>
            <li>Intermedio: supporto post‑capillare se E/e′ lat &gt;13, LAVi &gt;34, LARS ≤16%</li>
          </ul>
        </details>
        <button id="calcPH" class="btn">Calcola</button><button class="btn ghost reset">↺ Reset</button>
        <div id="phResult" class="status" role="status" aria-live="polite" style="display:none"></div>
        <div id="phDetails" class="card" style="display:none"></div>
      </div>

      <div id="sp_block" class="sub section">
        <h3>Blocco AV / LBBB / Pacing</h3>
        <div class="grid">
          <div><label for="block_ea">E/A</label><input id="block_ea" type="number"></div>
          <div><label for="block_ee">E/e′ medio</label><input id="block_ee" type="number"></div>
          <div><label for="block_tr">TR max (m/s)</label><input id="block_tr" type="number"></div>
          <div><label for="block_lavi">LAVi (mL/m²)</label><input id="block_lavi" type="number"></div>
          <div><label for="block_lars">LARS (%)</label><input id="block_lars" type="number"></div>
        </div>
        <details class="refs"><summary>Riferimenti &amp; cut-off</summary>
          <ul>
            <li>E/e′ ≥14, TR ≥2.8, LAVi &gt;34, LARS ≤18%</li>
            <li>E/A ≤0.8 → rilasciamento alterato (se non fuso)</li>
          </ul>
        </details>
        <button id="calcBlock" class="btn">Calcola</button><button class="btn ghost reset">↺ Reset</button>
        <div id="blockResult" class="status" role="status" aria-live="polite" style="display:none"></div>
        <div id="blockDetails" class="card" style="display:none"></div>
      </div>

      <div id="sp_restr" class="sub section">
        <h3>Restrittiva / Amiloidosi</h3>
        <div class="grid">
          <div><label for="restr_ea">E/A</label><input id="restr_ea" type="number"></div>
          <div><label for="restr_dt">DT (ms)</label><input id="restr_dt" type="number"></div>
          <div><label for="restr_ivrt">IVRT (ms)</label><input id="restr_ivrt" type="number"></div>
          <div><label for="restr_eprime_med">e′ mediale (cm/s)</label><input id="restr_eprime_med" type="number"></div>
          <div><label for="restr_apex">Apical sparing</label>
            <select id="restr_apex"><option value="no">No</option><option value="si">Sì</option></select>
          </div>
        </div>
        <details class="refs"><summary>Riferimenti &amp; cut-off</summary>
          <ul>
            <li>E/A ≥2.5, DT &lt;150, IVRT &lt;50; e′ mediale ≤4; apical‑sparing GLS</li>
            <li>≥3 criteri → alta probabilità</li>
          </ul>
        </details>
        <button id="calcRestr" class="btn">Calcola</button><button class="btn ghost reset">↺ Reset</button>
        <div id="restrResult" class="status" role="status" aria-live="polite" style="display:none"></div>
        <div id="restrDetails" class="card" style="display:none"></div>
      </div>

      <div id="sp_costr" class="sub section">
        <h3>Pericardite costrittiva</h3>
        <div class="grid">
          <div><label for="costr_resp_mitral">Δ mitralica (%)</label><input id="costr_resp_mitral" type="number"></div>
          <div><label for="costr_resp_tric">Δ tricuspidale (%)</label><input id="costr_resp_tric" type="number"></div>
          <div><label for="costr_eprime_med">e′ mediale (cm/s)</label><input id="costr_eprime_med" type="number"></div>
          <div><label for="costr_reversus">Reversus epatico</label>
            <select id="costr_reversus"><option value="no">No</option><option value="si">Sì</option></select>
          </div>
        </div>
        <details class="refs"><summary>Riferimenti &amp; cut-off</summary>
          <ul>
            <li>Δ mitralica ≥25%, Δ tricuspidale ≥40%, e′ mediale ≥7; reversus epatico presente</li>
            <li>≥2 criteri → compatibile</li>
          </ul>
        </details>
        <button id="calcCostr" class="btn">Calcola</button><button class="btn ghost reset">↺ Reset</button>
        <div id="costrResult" class="status" role="status" aria-live="polite" style="display:none"></div>
        <div id="costrDetails" class="card" style="display:none"></div>
      </div>

      <div id="sp_hcm" class="sub section">
        <h3>Cardiomiopatia ipertrofica (HCM)</h3>
        <div class="grid">
          <div><label for="hcm_ee">E/e′ medio</label><input id="hcm_ee" type="number"></div>
          <div><label for="hcm_ea">E/A</label><input id="hcm_ea" type="number"></div>
          <div><label for="hcm_lavi">LAVi (mL/m²)</label><input id="hcm_lavi" type="number"></div>
          <div><label for="hcm_tr">TR max (m/s)</label><input id="hcm_tr" type="number"></div>
        </div>
        <details class="refs"><summary>Riferimenti &amp; cut-off</summary>
          <ul>
            <li>E/e′ &gt;14, E/A ≥2, LAVi &gt;34, TR ≥2.8; supporto: PV S/D &lt;1</li>
            <li>≥2 indici alterati → riempimento elevato</li>
          </ul>
        </details>
        <button id="calcHcm" class="btn">Calcola</button><button class="btn ghost reset">↺ Reset</button>
        <div id="hcmResult" class="status" role="status" aria-live="polite" style="display:none"></div>
        <div id="hcmDetails" class="card" style="display:none"></div>
      </div>
    </section>

    <section id="about" class="section" data-route="true">
      <h2>Info</h2>
      <p>App clinica per stima della funzione diastolica. Nessun riferimento esplicito a società/linee guida nel testo.</p>
    </section>
  </div>

  <div class="card util">
    <button class="btn" id="forceUpdateBtn">🔄 Aggiorna app</button>
    <small class="hint">Se non vedi gli aggiornamenti, premi qui.</small>
  </div>
</main>

<div id="toast" style="opacity:0"></div>
<script src="app.js"></script>
</body>
</html>
