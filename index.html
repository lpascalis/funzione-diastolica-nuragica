<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <title>Funzione Diastolica Nuragica</title>
  <meta name="theme-color" content="#ffffff" />
  <link rel="icon" href="assets/favicon.png" type="image/png" />
  <link rel="apple-touch-icon" href="assets/apple-touch-icon.png"/>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="app-header">
  <div class="brand" style="padding-top:calc(12px + env(safe-area-inset-top));">
    <img class="logo photo" src="assets/logo_header.jpg" alt="Logo medico ecografo">
    <div class="title">
      <h1>Funzione Diastolica Nuragica</h1>
      <p class="subtitle">Calcolatori per LAP e grading</p>
    </div>
  </div>
  <nav class="tabs" id="tabs">
    <button data-target="sinus">Ritmo sinusale</button>
    <button data-target="af">Fibrillazione atriale</button>
    <button data-target="special">Popolazioni speciali</button>
    <button data-target="about">Info</button>
  </nav>
  <div class="wizard-bar"><button id="openWizard" class="ghost small">Wizard scenario</button></div>
</header>

<main id="content">
  <!-- SINUS -->
  <section id="sinus" class="panel hidden">
    <div class="card">
      <div class="card-header">
        <h2>Ritmo sinusale</h2>
        <button class="ghost" data-reset="sinus">Reset</button>
      </div>
      <p class="hint">Algoritmo in due stadi: (1) LAP con e′ ridotta + E/e′ aumentato + TR/PASP; (2) grading da E/A. Soglie e′ corrette per età (obbligatorie).</p>
      <div class="grid grid-iphone">
        <div class="field"><label>Età (anni)</label><input type="number" inputmode="numeric" id="sin_age" /></div>
        <div class="field"><label>e′ settale (cm/s)</label><input type="number" inputmode="decimal" id="sin_e_sept" /></div>
        <div class="field"><label>e′ laterale (cm/s)</label><input type="number" inputmode="decimal" id="sin_e_lat" /></div>
        <div class="field"><label>Picco E (cm/s)</label><input type="number" inputmode="decimal" id="sin_E" /></div>
        <div class="field"><label>E/A</label><input type="number" inputmode="decimal" id="sin_EA" /></div>
        <div class="field"><label>TR (m/s)</label><input type="number" inputmode="decimal" id="sin_TR" /></div>
        <div class="field"><label>PASP (mmHg)</label><input type="number" inputmode="numeric" id="sin_PASP" /></div>
        <div class="field"><label>LAVi (mL/m²)</label><input type="number" inputmode="decimal" id="sin_lavi" /></div>
      </div>
      <details class="extras">
        <summary>Metodi di supporto</summary>
        <div class="grid grid-iphone">
          <div class="field"><label>PV S/D</label><input type="number" inputmode="decimal" id="sin_pv_sd" /></div>
          <div class="field"><label>LARS (%)</label><input type="number" inputmode="decimal" id="sin_lars" /></div>
          <div class="field"><label>IVRT (ms)</label><input type="number" inputmode="numeric" id="sin_ivrt" /></div>
          <div class="field"><label>Ar–A PV (ms)</label><input type="number" inputmode="numeric" id="sin_ar_a" /></div>
          <div class="field"><label>L-wave mitralica (cm/s)</label><input type="number" inputmode="decimal" id="sin_lwave" /></div>
          <div class="field"><label>PR end-diastolica (m/s)</label><input type="number" inputmode="decimal" id="sin_pr_ed" /></div>
          <div class="field"><label>PADP (mmHg)</label><input type="number" inputmode="numeric" id="sin_padp" /></div>
        </div>
      </details>
      <details class="helper">
        <summary>Calcolo rapido LAVi</summary>
        <div class="grid grid-iphone">
          <div class="field"><label>Peso (kg)</label><input type="number" inputmode="decimal" id="sin_peso" /></div>
          <div class="field"><label>Altezza (cm)</label><input type="number" inputmode="decimal" id="sin_altezza" /></div>
          <div class="field"><label>Volume LA (mL)</label><input type="number" inputmode="decimal" id="sin_la_vol" /></div>
        </div>
        <div class="actions"><button class="ghost" data-lavi="sin">Calcola & inserisci</button></div>
        <div class="inline-msg" id="sin_lavi_msg"></div>
      </details>
      <div class="actions sticky">
        <button class="primary" id="sin_calc">Calcola</button>
      </div>
      <div class="result" id="sin_result"></div>
      <details class="thresholds"><summary>Soglie rapide</summary>
        <ul>
          <li>e′ (20–39): sept &lt;7, lat &lt;10, medio &lt;9 cm/s</li>
          <li>e′ (40–65): sept &lt;6, lat &lt;8, medio &lt;7 cm/s</li>
          <li>e′ (&gt;65): sept &lt;6, lat &lt;7, medio &lt;6.5 cm/s</li>
          <li>E/e′: medio &gt;14, settale &gt;15, laterale &gt;13 → sosp. LAP↑</li>
          <li>TR ≥2.8 m/s o PASP ≥35 mmHg → supporto LAP↑</li>
          <li>E/A: ≤0.8 (con E bassa) = Grado I; 0.8–2 → Grado I–II; ≥2 → Grado III</li>
        </ul>
      </details>
    </div>
  </section>

  <!-- AF -->
  <section id="af" class="panel hidden">
    <div class="card">
      <div class="card-header">
        <h2>Fibrillazione atriale</h2>
        <button class="ghost" data-reset="af">Reset</button>
      </div>
      <p class="hint">LAP aumentate se ≥2/4: E≥100, E/e′ settale&gt;11 (calcolata), TR≥2.8 o PASP≥35, DT≤160.</p>
      <div class="grid grid-iphone">
        <div class="field"><label>Picco E (cm/s)</label><input type="number" inputmode="decimal" id="af_E" /></div>
        <div class="field"><label>e′ settale (cm/s)</label><input type="number" inputmode="decimal" id="af_e_sept" /></div>
        <div class="field"><label>TR (m/s)</label><input type="number" inputmode="decimal" id="af_TR" /></div>
        <div class="field"><label>PASP (mmHg)</label><input type="number" inputmode="numeric" id="af_PASP" /></div>
        <div class="field"><label>DT (ms)</label><input type="number" inputmode="numeric" id="af_DT" /></div>
        <div class="field"><label>LAVi (mL/m²)</label><input type="number" inputmode="decimal" id="af_lavi" /></div>
      </div>
      <details class="helper">
        <summary>Calcolo rapido LAVi</summary>
        <div class="grid grid-iphone">
          <div class="field"><label>Peso (kg)</label><input type="number" inputmode="decimal" id="af_peso" /></div>
          <div class="field"><label>Altezza (cm)</label><input type="number" inputmode="decimal" id="af_altezza" /></div>
          <div class="field"><label>Volume LA (mL)</label><input type="number" inputmode="decimal" id="af_la_vol" /></div>
        </div>
        <div class="actions"><button class="ghost" data-lavi="af">Calcola & inserisci</button></div>
        <div class="inline-msg" id="af_lavi_msg"></div>
      </details>
      <div class="actions sticky"><button class="primary" id="af_calc">Calcola</button></div>
      <div class="result" id="af_result"></div>
      <details class="thresholds"><summary>Soglie rapide</summary>
        <ul>
          <li>Quattro criteri: E ≥100 • E/e′ sept &gt;11 • TR ≥2.8/PASP ≥35 • DT ≤160</li>
          <li>≥2 criteri → LAP↑; 0–1 → LAP normale</li>
        </ul>
      </details>
    </div>
  </section>

  <!-- SPECIAL POPULATIONS -->
  <section id="special" class="panel hidden">
    <div class="card">
      <div class="card-header">
        <h2>Popolazioni speciali</h2>
        <button class="ghost" data-reset="special_all">Reset tutto</button>
      </div>
      <div class="tabs sub" id="spTabs">
        <button data-target="sp_valv">Valvulopatie</button>
        <button data-target="sp_htx">Trapianto</button>
        <button data-target="sp_ph">Ipertensione polmonare</button>
        <button data-target="sp_av">AV/LBBB/Pacing</button>
        <button data-target="sp_rcm">Restrittiva</button>
        <button data-target="sp_cp">Costrizione</button>
        <button data-target="sp_hcm">HCM</button>
      </div>

      <section id="sp_valv" class="subpanel hidden">
        <p class="hint">MR severa, MS o MAC moderata/severa: usa indicatori alternativi.</p>
        <div class="grid grid-iphone">
          <div class="field"><label>MR severa?</label><select id="valv_mr"><option value="no">No</option><option value="si">Sì</option></select></div>
          <div class="field"><label>MS presente?</label><select id="valv_ms"><option value="no">No</option><option value="si">Sì</option></select></div>
          <div class="field"><label>MAC moderata/severa?</label><select id="valv_mac"><option value="no">No</option><option value="si">Sì</option></select></div>
          <div class="field"><label>Picco E (cm/s)</label><input type="number" inputmode="decimal" id="valv_E" /></div>
          <div class="field"><label>e′ settale (cm/s)</label><input type="number" inputmode="decimal" id="valv_e_sept" /></div>
          <div class="field"><label>e′ laterale (cm/s)</label><input type="number" inputmode="decimal" id="valv_e_lat" /></div>
          <div class="field"><label>Ar–A PV (ms)</label><input type="number" inputmode="numeric" id="valv_ar_a" /></div>
          <div class="field"><label>PV S/D</label><input type="number" inputmode="decimal" id="valv_pv_sd" /></div>
          <div class="field"><label>TR (m/s)</label><input type="number" inputmode="decimal" id="valv_TR" /></div>
          <div class="field"><label>PASP (mmHg)</label><input type="number" inputmode="numeric" id="valv_PASP" /></div>
          <div class="field"><label>LAVi (mL/m²)</label><input type="number" inputmode="decimal" id="valv_lavi" /></div>
          <div class="field"><label>LARS (%)</label><input type="number" inputmode="decimal" id="valv_lars" /></div>
        </div>
        <details class="helper">
          <summary>Calcolo rapido LAVi</summary>
          <div class="grid grid-iphone">
            <div class="field"><label>Peso (kg)</label><input type="number" inputmode="decimal" id="valv_peso" /></div>
            <div class="field"><label>Altezza (cm)</label><input type="number" inputmode="decimal" id="valv_altezza" /></div>
            <div class="field"><label>Volume LA (mL)</label><input type="number" inputmode="decimal" id="valv_la_vol" /></div>
          </div>
          <div class="actions"><button class="ghost" data-lavi="valv">Calcola & inserisci</button></div>
          <div class="inline-msg" id="valv_lavi_msg"></div>
        </details>
        <div class="actions sticky"><button class="primary" id="valv_calc">Calcola</button></div>
        <div class="result" id="valv_result"></div>
        <details class="thresholds"><summary>Soglie rapide</summary>
          <ul>
            <li>Ar–A PV &gt;30 ms → LAP↑</li>
            <li>E/e′ medio &gt;14 (con cautela)</li>
            <li>TR ≥2.8 o PASP ≥35 → supporto LAP↑</li>
          </ul>
        </details>
      </section>

      <section id="sp_htx" class="subpanel hidden">
        <p class="hint">E/e′ medio &lt;7 normale, &gt;14 aumentato; 7–14 → E/SRIVR (200 cm) o TR.</p>
        <div class="grid grid-iphone">
          <div class="field"><label>Picco E (cm/s)</label><input type="number" inputmode="decimal" id="htx_E" /></div>
          <div class="field"><label>e′ settale (cm/s)</label><input type="number" inputmode="decimal" id="htx_e_sept" /></div>
          <div class="field"><label>e′ laterale (cm/s)</label><input type="number" inputmode="decimal" id="htx_e_lat" /></div>
          <div class="field"><label>SRIVR (1/s)</label><input type="number" inputmode="decimal" id="htx_srivr" /></div>
          <div class="field"><label>TR (m/s)</label><input type="number" inputmode="decimal" id="htx_TR" /></div>
        </div>
        <div class="actions sticky"><button class="primary" id="htx_calc">Calcola</button></div>
        <div class="result" id="htx_result"></div>
        <details class="thresholds"><summary>Soglie rapide</summary>
          <ul>
            <li>E/e′ medio: &lt;7 = normale • &gt;14 = LAP↑</li>
            <li>Se 7–14 → E/SRIVR &gt;200 cm = LAP↑ (altrimenti normale)</li>
            <li>Se SRIVR non disponibile → TR &gt;2.8 m/s = LAP↑</li>
          </ul>
        </details>
      </section>

      <section id="sp_ph" class="subpanel hidden">
        <p class="hint">Variabile guida: E/e′ laterale (calcolata). Integra con E/A, LARS, LAVi.</p>
        <div class="grid grid-iphone">
          <div class="field"><label>Picco E (cm/s)</label><input type="number" inputmode="decimal" id="ph_E" /></div>
          <div class="field"><label>e′ laterale (cm/s)</label><input type="number" inputmode="decimal" id="ph_e_lat" /></div>
          <div class="field"><label>E/A</label><input type="number" inputmode="decimal" id="ph_EA" /></div>
          <div class="field"><label>LARS (%)</label><input type="number" inputmode="decimal" id="ph_lars" /></div>
          <div class="field"><label>LAVi (mL/m²)</label><input type="number" inputmode="decimal" id="ph_lavi" /></div>
        </div>
        <details class="helper">
          <summary>Calcolo rapido LAVi</summary>
          <div class="grid grid-iphone">
            <div class="field"><label>Peso (kg)</label><input type="number" inputmode="decimal" id="ph_peso" /></div>
            <div class="field"><label>Altezza (cm)</label><input type="number" inputmode="decimal" id="ph_altezza" /></div>
            <div class="field"><label>Volume LA (mL)</label><input type="number" inputmode="decimal" id="ph_la_vol" /></div>
          </div>
          <div class="actions"><button class="ghost" data-lavi="ph">Calcola & inserisci</button></div>
          <div class="inline-msg" id="ph_lavi_msg"></div>
        </details>
        <div class="actions sticky"><button class="primary" id="ph_calc">Calcola</button></div>
        <div class="result" id="ph_result"></div>
        <details class="thresholds"><summary>Soglie rapide</summary>
          <ul>
            <li>E/e′ laterale: &gt;13 = LAP↑ • &lt;8 = normale • 8–13 = grigio</li>
            <li>Se grigio: E/A ≥2 o LAVi &gt;34 o LARS &lt;16 → postcapillare</li>
          </ul>
        </details>
      </section>

      <section id="sp_av" class="subpanel hidden">
        <p class="hint">Se fusione E/A o sola E → usa TR/PASP; altrimenti E/e′ calcolato con cautela.</p>
        <div class="grid grid-iphone">
          <div class="field"><label>E e A separabili?</label><select id="av_sep"><option value="si">Sì</option><option value="no">No (fusione)</option></select></div>
          <div class="field"><label>Solo onda E?</label><select id="av_onlyE"><option value="no">No</option><option value="si">Sì</option></select></div>
          <div class="field"><label>Picco E (cm/s)</label><input type="number" inputmode="decimal" id="av_E" /></div>
          <div class="field"><label>e′ settale (cm/s)</label><input type="number" inputmode="decimal" id="av_e_sept" /></div>
          <div class="field"><label>e′ laterale (cm/s)</label><input type="number" inputmode="decimal" id="av_e_lat" /></div>
          <div class="field"><label>TR (m/s)</label><input type="number" inputmode="decimal" id="av_TR" /></div>
          <div class="field"><label>PASP (mmHg)</label><input type="number" inputmode="numeric" id="av_PASP" /></div>
        </div>
        <div class="actions sticky"><button class="primary" id="av_calc">Calcola</button></div>
        <div class="result" id="av_result"></div>
        <details class="thresholds"><summary>Soglie rapide</summary>
          <ul>
            <li>Fusione E/A o sola E: privilegia TR/PASP</li>
            <li>Se separabili: E/e′ medio &gt;14 o TR/PASP↑ → LAP↑</li>
          </ul>
        </details>
      </section>

      <section id="sp_rcm" class="subpanel hidden">
        <p class="hint">Criteri tipici delle fasi avanzate; restituisce coerenza con fisiologia restrittiva e grado.</p>
        <div class="grid grid-iphone">
          <div class="field"><label>E/A</label><input type="number" inputmode="decimal" id="rcm_EA" /></div>
          <div class="field"><label>DT (ms)</label><input type="number" inputmode="numeric" id="rcm_DT" /></div>
          <div class="field"><label>IVRT (ms)</label><input type="number" inputmode="numeric" id="rcm_IVRT" /></div>
          <div class="field"><label>e′ settale (cm/s)</label><input type="number" inputmode="decimal" id="rcm_e_sept" /></div>
          <div class="field"><label>e′ laterale (cm/s)</label><input type="number" inputmode="decimal" id="rcm_e_lat" /></div>
        </div>
        <div class="actions sticky"><button class="primary" id="rcm_calc">Calcola</button></div>
        <div class="result" id="rcm_result"></div>
        <details class="thresholds"><summary>Soglie rapide</summary>
          <ul>
            <li>E/A &gt;2.5 • DT &lt;150 ms • IVRT &lt;50 ms → compatibile con restrittivo (LAP↑)</li>
            <li>e′ molto bassa (≤4) rafforza il sospetto</li>
          </ul>
        </details>
      </section>

      <section id="sp_cp" class="subpanel hidden">
        <p class="hint">Differenziale con restrizione: usa variazioni respiratorie, HV reversal, e′ mediale e annulus reversus.</p>
        <div class="grid grid-iphone">
          <div class="field"><label>Variazione mitrale con respiro (%)</label><input type="number" inputmode="numeric" id="cp_mitral_var" /></div>
          <div class="field"><label>Variazione tricuspide con respiro (%)</label><input type="number" inputmode="numeric" id="cp_tric_var" /></div>
          <div class="field"><label>Rapporto HV end-diastolico/anterogrado</label><input type="number" inputmode="decimal" id="cp_hv_ratio" /></div>
          <div class="field"><label>e′ mediale (cm/s)</label><input type="number" inputmode="decimal" id="cp_e_medial" /></div>
          <div class="field"><label>e′ laterale (cm/s)</label><input type="number" inputmode="decimal" id="cp_e_lateral" /></div>
        </div>
        <div class="actions sticky"><button class="primary" id="cp_calc">Calcola</button></div>
        <div class="result" id="cp_result"></div>
        <details class="thresholds"><summary>Soglie rapide</summary>
          <ul>
            <li>Annulus reversus/paradoxus: e′ mediale &gt; laterale</li>
            <li>Variazioni respiratorie: mitrale &gt;25%, tricuspide &gt;40%</li>
            <li>HV reversal (rapporto ≥0.8 in esp.)</li>
          </ul>
        </details>
      </section>

      <section id="sp_hcm" class="subpanel hidden">
        <p class="hint">LAP multiparametriche (E/e′ calcolato, PV, TR/PASP, LAVi); grading via E/A.</p>
        <div class="grid grid-iphone">
          <div class="field"><label>Picco E (cm/s)</label><input type="number" inputmode="decimal" id="hcm_E" /></div>
          <div class="field"><label>e′ settale (cm/s)</label><input type="number" inputmode="decimal" id="hcm_e_sept" /></div>
          <div class="field"><label>e′ laterale (cm/s)</label><input type="number" inputmode="decimal" id="hcm_e_lat" /></div>
          <div class="field"><label>TR (m/s)</label><input type="number" inputmode="decimal" id="hcm_TR" /></div>
          <div class="field"><label>PASP (mmHg)</label><input type="number" inputmode="numeric" id="hcm_PASP" /></div>
          <div class="field"><label>PV S/D</label><input type="number" inputmode="decimal" id="hcm_pv_sd" /></div>
          <div class="field"><label>LAVi (mL/m²)</label><input type="number" inputmode="decimal" id="hcm_lavi" /></div>
          <div class="field"><label>E/A</label><input type="number" inputmode="decimal" id="hcm_EA" /></div>
        </div>
        <details class="helper">
          <summary>Calcolo rapido LAVi</summary>
          <div class="grid grid-iphone">
            <div class="field"><label>Peso (kg)</label><input type="number" inputmode="decimal" id="hcm_peso" /></div>
            <div class="field"><label>Altezza (cm)</label><input type="number" inputmode="decimal" id="hcm_altezza" /></div>
            <div class="field"><label>Volume LA (mL)</label><input type="number" inputmode="decimal" id="hcm_la_vol" /></div>
          </div>
          <div class="actions"><button class="ghost" data-lavi="hcm">Calcola & inserisci</button></div>
          <div class="inline-msg" id="hcm_lavi_msg"></div>
        </details>
        <div class="actions sticky"><button class="primary" id="hcm_calc">Calcola</button></div>
        <div class="result" id="hcm_result"></div>
        <details class="thresholds"><summary>Soglie rapide</summary>
          <ul>
            <li>Indizi LAP↑: E/e′ medio &gt;14 • TR/PASP↑ • PV S/D ≤0.67 • LAVi &gt;34</li>
            <li>Grading via E/A (come sinusale)</li>
          </ul>
        </details>
      </section>
    </div>
  </section>

  <!-- INFO -->
  <section id="about" class="panel hidden">
    <div class="card">
      <h2>Info</h2>
      <p>App per stima della funzione diastolica secondo il documento condiviso. Nessun riferimento esplicito a società scientifiche.</p>
    </div>
  </section>
</main>

<footer class="app-footer" style="padding-bottom:calc(24px + env(safe-area-inset-bottom));">
  <p>© Funzione Diastolica Nuragica — uso clinico a discrezione medica.</p>
</footer>

<!-- Wizard Modal -->
<div id="wizard" class="modal hidden">
  <div class="modal-card">
    <div class="modal-head"><h3>Wizard Scenario</h3><button id="closeWizard" class="ghost small">Chiudi</button></div>
    <div class="grid grid-iphone">
      <div class="field">
        <label>Ritmo</label>
        <select id="w_ritmo">
          <option value="sinus">Ritmo sinusale</option>
          <option value="af">Fibrillazione atriale</option>
        </select>
      </div>
      <div class="field">
        <label>Condizione</label>
        <select id="w_cond">
          <option value="">Nessuna</option>
          <option value="sp_valv">Valvulopatie</option>
          <option value="sp_htx">Trapianto</option>
          <option value="sp_ph">Ipertensione polmonare</option>
          <option value="sp_av">AV/LBBB/Pacing</option>
          <option value="sp_rcm">Restrittiva</option>
          <option value="sp_cp">Costrizione</option>
          <option value="sp_hcm">HCM</option>
        </select>
      </div>
    </div>
    <div class="actions"><button id="w_go" class="primary">Vai al calcolatore</button></div>
  </div>
</div>

<script src="app.js"></script>
</body>
</html>
